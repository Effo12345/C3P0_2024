#include <autonomous.hpp>
#include <FEHRCS.h>

void startup() {
    // Set drive parameters
    chassis->setPIDConstants(1.6f, 0.005f, 0.3f);
    chassis->setPPConstants(1.2f, 0.001f, 0.15f);

    // Set servo parameters
    fuelArm.SetMin(875);
    fuelArm.SetMax(2272);

    passportArm.SetMin(500);
    passportArm.SetMax(2500);

    gui->withCdsCell(cds);

    // Connect to RCS
    RCS.InitializeTouchMenu("C3Hp3wz3E");

    gui->init();

    // Wait for permission to sample ambient light level
    gui->pause();
    cds->sampleAmbient();

    // Await final action
    gui->pause();

    // Set absolute pos, reset encoders
    chassis->getOdomModel()->setPos({{12.01f, -29.9f}, 135.0f}); // Backwards
    // chassis->getOdomModel()->setPos({{6.14f, -24.18f}, -44.23f});  // Forwards
    // chassis->getOdomModel()->setPos({{0.0f, 0.0f}, 0.0f});

    chassis->getOdomModel()->tarSensors();

    // Hold control until starting light crosses threshold
    cds->awaitStartingLight();
}

int main(void) {
    // Finish setting up internal state and await final action
    startup();

    // chassis->followNewPath({
    //     {0, 0},
    //     {0.14333802267729784, 1.802812130956765},
    //     {0.31477667510362495, 3.574932284494928},
    //     {0.5485955740653025, 5.28081414440694},
    //     {0.8880798837270405, 6.874749744788753},
    //     {1.3930096916712595, 8.293367618567043},
    //     {2.148867361340023, 9.445987461919522},
    //     {3.279760435256375, 10.226997763864173},
    //     {4.650128490315059, 10.758272725092809},
    //     {6.161703859678404, 11.1227234762174},
    //     {7.73832861963527, 11.377143448605816},
    //     {9.313848777281251, 11.56129691189851},
    //     {10.822004037526202, 11.703939752185642},
    //     {12.185070093457943, 11.827317862296773}
    // }, {
    //     61.44667891837851,
    //     56.54178894657885,
    //     51.256687116014085,
    //     45.56601638521388,
    //     39.43046985007815,
    //     32.755247765770704,
    //     25.13630288060828,
    //     42.568586367284546,
    //     49.38560607825987,
    //     44.06101598632513,
    //     37.81965761025211,
    //     30.37643482343193,
    //     20.92759677588025,
    //     0
    // });

    // chassis->followNewPath({
    //     {3.4936214953271025, 0.8075550118294833},
    //     {3.5163616224221035, 2.80352490284768},
    //     {3.538095412958003, 4.798913031803248},
    //     {3.559816108107657, 6.793098868033363},
    //     {3.5815131296115457, 8.78511121723867},
    //     {3.6031724056966765, 10.773658144230366},
    //     {3.624774892698808, 12.756991242466023},
    //     {3.64629305777714, 14.732582710658688},
    //     {3.667685608395717, 16.69664146432528},
    //     {3.6888923827042905, 18.64364401958009},
    //     {3.7098207273739168, 20.565083836692843},
    //     {3.730340846691913, 22.449044318609182},
    //     {3.749252336448598, 24.27712627351173}
    // }, {
    //     86.66434360008174,
    //     82.89726554749917,
    //     78.95184962468277,
    //     74.80118474701808,
    //     70.41118857866152,
    //     65.73707261088154,
    //     60.71785962962924,
    //     55.26691333082994,
    //     49.25338189185073,
    //     42.45960260871635,
    //     34.46622464112104,
    //     24.187135568299897,
    //     0
    // });

    // Run autonomous route
    showcase();


	return 0;
}
